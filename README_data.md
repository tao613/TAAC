# 数据集说明

本项目使用的数据集包含用户行为序列、用户特征、物品特征以及多模态特征，用于训练和评估推荐模型。

## 文件结构

```
data/
├── seq.jsonl                    # 训练用用户行为序列
├── predict_seq.jsonl            # 预测用用户行为序列
├── item_feat_dict.json          # 物品特征字典
├── indexer.pkl                  # 用户/物品/特征的ID映射
├── seq_offsets.pkl              # 训练序列文件的偏移量索引
├── predict_seq_offsets.pkl      # 预测序列文件的偏移量索引
└── creative_emb/                # 多模态特征Embedding目录
    ├── emb_81_32.pkl
    └── emb_82_1024/
        └── ...
```

## 数据格式详解

### 1. `seq.jsonl` / `predict_seq.jsonl`

这两个文件包含了用户的行为序列，每行是一个JSON对象，代表一个用户的完整交互历史。

- **格式**: `List[Tuple[user_id, item_id, user_feat, item_feat, action_type, timestamp]]`
- **示例**: `[(123, 456, {"103": 1}, {"100": 2}, 1, 1678886400), ...]`

**元组字段说明**:

| 字段 | 类型 | 描述 |
| :--- | :--- | :--- |
| `user_id` | `int` | 经过重新编码的用户ID (re-id) |
| `item_id` | `int` | 经过重新编码的物品ID (re-id) |
| `user_feat` | `dict` | 用户的特征字典，key为特征ID，value为特征值 |
| `item_feat` | `dict` | 物品的特征字典，key为特征ID，value为特征值 |
| `action_type`| `int` | 交互类型（例如：0表示曝光，1表示点击） |
| `timestamp` | `int` | 交互发生的Unix时间戳 |

### 2. `item_feat_dict.json`

一个JSON对象，存储了所有物品的特征信息。

- **格式**: `{ "item_id_str": {"feat_id": feat_value, ...}, ... }`
- **示例**: `{ "456": {"100": 2, "117": 5}, "789": {"100": 3, "117": 8} }`
- **作用**: 用于在生成负样本或处理候选物品时，快速查找物品的特征。

### 3. `indexer.pkl`

一个使用pickle序列化的Python字典，包含了从原始ID到整数ID的映射。

- **`i`**: 物品ID映射 (`creative_id` (str) -> `item_reid` (int))
- **`u`**: 用户ID映射 (`user_id` (str) -> `user_reid` (int))
- **`f`**: 特征值映射，一个嵌套字典。
  - **格式**: `{ "feat_id": { "raw_feat_value": feat_reid, ... }, ... }`
  - **示例**: `{ "103": { "male": 1, "female": 2 }, "100": { "category_A": 1, ... } }`

### 4. `creative_emb/`

该目录存放预训练好的多模态特征Embedding。

- 文件名通常包含特征ID和维度，例如 `emb_81_32.pkl` 或 `emb_82_1024/`。
- 支持 `.pkl` 和 `.json` 两种格式。

## 特征描述

模型使用的特征被划分为不同类型，以便进行不同的处理（如Embedding、直接输入等）。

| 特征类别 | 特征ID | 描述 |
| :--- | :--- | :--- |
| **用户稀疏特征** | `103`, `104`, `105`, `109` | 用户的类别型特征，如性别、年龄段等。 |
| **用户数组特征** | `106`, `107`, `108`, `110` | 用户的多值类别型特征，如兴趣标签列表。 |
| **物品稀疏特征** | `100`, `117`, `111`, ... | 物品的类别型特征，如品类、品牌等。 |
| **物品多模态特征**| `81` - `86` | 预训练的Embedding，如图像、文本特征。 |
| **用户/物品连续特征**| - | 连续型数值特征（当前模型未启用）。 |
| **物品数组特征** | - | 物品的多值类别型特征（当前模型未启用）。 |

这个文件为理解数据处理流程和进行特征工程提供了基础。
